Version 4
SHEET 1 1828 1368
WIRE -1296 -560 -1360 -560
WIRE -1152 -560 -1216 -560
WIRE -1504 -512 -1600 -512
WIRE -1360 -512 -1360 -560
WIRE -1360 -512 -1424 -512
WIRE -3184 -496 -3232 -496
WIRE -3040 -496 -3104 -496
WIRE -2640 -496 -2688 -496
WIRE -2512 -496 -2576 -496
WIRE -2496 -496 -2512 -496
WIRE -2512 -464 -2512 -496
WIRE -1360 -464 -1360 -512
WIRE -1296 -464 -1360 -464
WIRE -3136 -448 -3152 -448
WIRE -2000 -448 -2000 -496
WIRE -1152 -448 -1152 -560
WIRE -1152 -448 -1232 -448
WIRE -2080 -432 -2080 -464
WIRE -2032 -432 -2080 -432
WIRE -1504 -432 -1600 -432
WIRE -1360 -432 -1424 -432
WIRE -1296 -432 -1360 -432
WIRE -3152 -416 -3152 -448
WIRE -1856 -416 -1968 -416
WIRE -3360 -400 -3376 -400
WIRE -3232 -400 -3232 -496
WIRE -3232 -400 -3280 -400
WIRE -3184 -400 -3232 -400
WIRE -2032 -400 -2128 -400
WIRE -3040 -384 -3040 -496
WIRE -3040 -384 -3120 -384
WIRE -3184 -368 -3216 -368
WIRE -1360 -368 -1360 -432
WIRE -2512 -336 -2512 -384
WIRE -3216 -304 -3216 -368
WIRE -3216 -304 -3312 -304
WIRE -1360 -256 -1360 -304
WIRE -3232 128 -3280 128
WIRE -2528 128 -2576 128
WIRE -1904 128 -1952 128
WIRE -3280 176 -3280 128
WIRE -2576 176 -2576 128
WIRE -1952 176 -1952 128
WIRE -3280 304 -3280 256
WIRE -2576 304 -2576 256
WIRE -1952 304 -1952 256
WIRE -3232 416 -3280 416
WIRE -2528 416 -2576 416
WIRE -1904 416 -1952 416
WIRE -3280 464 -3280 416
WIRE -2576 464 -2576 416
WIRE -1952 464 -1952 416
WIRE -3280 592 -3280 544
WIRE -2576 592 -2576 544
WIRE -1952 592 -1952 544
WIRE -1904 688 -1952 688
WIRE -3232 704 -3280 704
WIRE -2528 704 -2576 704
WIRE -1952 736 -1952 688
WIRE -3280 752 -3280 704
WIRE -2576 752 -2576 704
WIRE -1952 864 -1952 816
WIRE -3280 880 -3280 832
WIRE -2576 880 -2576 832
FLAG -2000 -496 VCC
FLAG -2080 -464 VBias
FLAG -3280 880 0
FLAG -1952 592 0
FLAG -3232 704 Vw
FLAG -1904 416 Vbias
FLAG -1952 304 0
FLAG -1904 128 VCC
FLAG -2000 -384 0
FLAG -2688 -496 Va
FLAG -2496 -496 Vf
FLAG -2128 -400 Vf
FLAG -3136 -448 VCC
FLAG -3040 -384 Va
FLAG -3152 -352 0
FLAG -3376 -400 0
FLAG -1856 -416 VComp
FLAG -3280 592 0
FLAG -3232 416 Vb
FLAG -3280 304 0
FLAG -3232 128 Vg
FLAG -2576 880 0
FLAG -2528 704 Vw_off
FLAG -2576 592 0
FLAG -2528 416 Vb_off
FLAG -2576 304 0
FLAG -2528 128 Vg_off
FLAG -3312 -304 Vw
FLAG -1952 864 0
FLAG -1904 688 V_offset
FLAG -2512 -336 0
FLAG -1600 -432 VComp
FLAG -1360 -256 0
FLAG -1600 -512 0
FLAG -1264 -416 0
FLAG -1264 -480 VCC
FLAG -1152 -448 Is_white
SYMBOL voltage -1952 448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vbias
SYMATTR Value 1
SYMBOL voltage -3280 736 R0
WINDOW 123 0 0 Left 0
WINDOW 39 -205 89 Left 2
WINDOW 3 26 103 Left 2
SYMATTR Value PWL file="./PWL Sources/on-white-2s.txt"
SYMATTR InstName Vwhite
SYMBOL voltage -1952 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vsupply
SYMATTR Value 5V
SYMBOL OpAmps\\UniversalOpAmp4 -2000 -416 R0
SYMATTR InstName U2
SYMBOL res -2528 -480 R0
SYMATTR InstName R4
SYMATTR Value 42k
SYMBOL cap -2576 -512 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 47n
SYMBOL OpAmps\\UniversalOpAmp4 -3152 -384 R0
SYMATTR InstName U4
SYMBOL res -3088 -512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL res -3264 -416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 40k
SYMBOL voltage -3280 448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 27 103 Left 2
SYMATTR Value PWL file="./PWL Sources/on-black-2s.txt"
SYMATTR InstName Vblack
SYMBOL voltage -3280 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 27 103 Left 2
SYMATTR Value PWL file="./PWL Sources/on-green-2s.txt"
SYMATTR InstName Vgreen
SYMBOL voltage -2576 736 R0
WINDOW 123 0 0 Left 0
WINDOW 39 -205 89 Left 2
WINDOW 3 26 103 Left 2
SYMATTR Value PWL file="./PWL Sources/off-white-2s.txt"
SYMATTR InstName Vwhite1
SYMBOL voltage -2576 448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 27 103 Left 2
SYMATTR Value PWL file="./PWL Sources/off-black-2s.txt"
SYMATTR InstName Vblack1
SYMBOL voltage -2576 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 27 103 Left 2
SYMATTR Value PWL file="./PWL Sources/off-green-2s.txt"
SYMATTR InstName Vgreen1
SYMBOL voltage -1952 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Voffset
SYMATTR Value 0.5
SYMBOL res -1408 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 4.7k
SYMBOL cap -1376 -368 R0
SYMATTR InstName C4
SYMATTR Value 1.6µ
SYMBOL OpAmps\\UniversalOpAmp4 -1264 -448 R0
SYMATTR InstName U7
SYMBOL res -1200 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res -1408 -528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 20k
TEXT -2272 -600 Left 2 ;PWM regenerator
TEXT -1712 128 Left 2 !.tran 0 250m 0 0.01
TEXT -2824 -608 Left 2 ;High pass filter (Cf = 110Hz)
TEXT -3456 -608 Left 2 ;Signal amplification \n(input signal comes from transimpedance amplifier)
TEXT -3400 504 Left 2 ;Black
TEXT -3408 792 Left 2 ;White
TEXT -3408 216 Left 2 ;Green
TEXT -3280 16 Left 2 ;Signal Waveforms
TEXT -2080 16 Left 2 ;Supply Voltages
TEXT -1712 16 Left 2 ;SPICE Directives
TEXT -2696 504 Left 2 ;Black
TEXT -2704 792 Left 2 ;White
TEXT -2704 216 Left 2 ;Green
TEXT -2704 16 Left 2 ;Signal Waveforms
TEXT -1680 -640 Left 2 ;Digital output (Low pass filter Cf = 10Hz & Amplication Gain = 5)
TEXT -3448 -664 Left 2 ;Notes on transimpedance amplifier:
TEXT -3448 -640 Left 1 ;FB resistor: ~4MOhm
RECTANGLE Normal -1760 -272 -2272 -576 2
RECTANGLE Normal -2320 -272 -2832 -576 2
RECTANGLE Normal -1408 960 -3424 -64 2
RECTANGLE Normal -1120 -224 -1680 -608 2
RECTANGLE Normal -2912 -240 -3456 -544 2
